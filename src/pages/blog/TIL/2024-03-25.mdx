---
title: "[RN] iOS 인앱 결제 기능넣기 1️⃣"
date: 2024-03-25 17:03:33
category: til
thumbnail: "react"
description: '인앱 결제 기능을 넣기 위해, 개발 외적으로 해주어야 하는 것들에 대해 알아보자.'
draft: false
---

import Layout from '/src/templates/blog-post';
export default Layout;

## 개요

회사에서 App Store 인앱결제 기능을 테스트해볼 필요가 있었다.

따라서 RN을 기본 베이스로 하여, [react-native-iap](https://github.com/dooboolab-community/react-native-iap) 이라는 인앱결제 라이브러리를 사용해서 이를 테스트해보았다.

![](https://i.imgur.com/LrVu0SD.png)

이 라이브러리의 주요 기능은 다음과 같다.

+ 상품 조회
+ 상품 구매
+ 정기 결제 구독

이때, [StoreKit 2](https://developer.apple.com/kr/storekit/)라는 iOS의 최신 결제 API를 사용한다면, 추가로 다음이 가능해진다.

+ 인앱 환불

하지만 StoreKit 2는 iOS 15 이상의 기기에서만 사용가능한 API이다.

![](https://i.imgur.com/Tb9IlLr.png)


[iOS 15 호환성 목록](https://support.apple.com/ko-kr/guide/iphone/iphe3fa5df43/15.0/ios/15.0)을 살펴보면, 2015년에 출시된 <b>iPhone 6s</b>까지도 iOS 15를 지원한다. 즉, StoreKit 2 API를 지원한다.

약 10년 전 출시된 기기까지도 iOS 15를 지원하니까, 호환성 이슈는 엄청 크지는 않을 것이다... <del>제발</del>


## 방법

### 1️⃣ 애플 개발자 콘솔에서 앱 등록하기

<Callout variant="warning">
  <b>⚠️ 아래 모든 작업은 Apple Developer Program에 등록되어야만 가능하다!</b>
  <br />
  <br />
  ![](https://i.imgur.com/yxgpZ0u.png)
  <br />

  개발자 계정을 위해서는 연간 129,000원을 지불해야 하므로, 이 점 유의하며 진행하자... 🥲
</Callout>

코드를 작성하기 전에, 애플 개발자 콘솔에서 다음과 같은 절차를 밟아야 한다.

1. Bundle ID 생성
2. 앱 생성
3. 인앱 상품 생성
4. 샌드박스 계정 생성


#### 1️⃣ Bundle ID 생성

[developer.apple.com/account/resources/identifiers/list](developer.apple.com/account/resources/identifiers/list)

위 링크에서 Bundle ID를 생성할 수 있다.

![](https://i.imgur.com/eeQX3CB.png)

실제 사용되는 값은 `[IDENTIFIER]`으로, `com.reactjs.native.GreenInappTest`로 작성해 주었다.

#### 2️⃣ 앱 생성

![](https://i.imgur.com/n1TENS3.png)

[appstoreconnect.apple.com/apps](appstoreconnect.apple.com/apps) 으로 접속한 뒤, 앱 생성 버튼(`+` 모양)을 클릭한다.


![](https://i.imgur.com/U4vgZfC.png)

이름, 기본 언어, 번들 ID, SKU를 작성하고, `생성` 버튼을 클릭하면, 앱이 대시보드에 생성된다.

#### 3️⃣ 인앱 상품 생성

![](https://i.imgur.com/e8YXvAy.png)

생성된 앱을 클릭하여 앱 세부 정보 페이지로 이동한다.

![](https://i.imgur.com/u7ClHF7.png)

`수익화 > 앱 내 구입 > 생성 버튼`을 클릭하자.

![](https://i.imgur.com/FyTdXad.png)

`유형`, `식별 정보`, `제품 ID`를 작성한 후 `생성` 버튼을 클릭하면 상품을 생성할 수 있다.

<Callout variant="info">
  <strong>🤔 소모품, 비소모품 상품의 차이는?</strong>
  <br />
  <br />
  1️⃣ 소모품(Consumables)

  - **정의**: 사용자가 구매한 후 한 번 사용하면 소모되는 상품이다.
  - **사용 사례**: 게임 내에서 사용할 수 있는 재화 등

  2️⃣ 비소모품(Non-Consumables)

  - **정의**: 사용자가 한 번 구매하면 영구적으로 사용할 수 있는 상품이다.
  - **사용 사례**: 앱에서 광고 제거, 프리미엄 기능 잠금 해제 등의 1회성 결제 상품 등
</Callout>

#### 4️⃣ 샌드박스 계정 생성

내가 생성한 앱은 실제 스토어에 등록된 앱이 아니기 때문에, 인앱 결제를 테스트하려면 애플에서 제공하는 테스트 계정인 [샌드박스 계정](https://developer.apple.com/kr/apple-pay/sandbox-testing/)을 사용해야 한다.

[appstoreconnect.apple.com/access/users/sandbox](appstoreconnect.apple.com/access/users/sandbox)

위 링크에 접속해서 테스트 계정을 생성할 수 있다.

여기서 까다로운 부분이 있는데, <u>이미 Apple ID로 생성되어 있는 계정을 샌드박스 계정으로 등록할 수 없다는 점이다!</u>

![](https://i.imgur.com/uIN2I3i.png)

이를 막으려면 Apple ID로 사용하지 않은 이메일을 사용해야 하는데, 나의 경우 내가 가진 모든 이메일은 애플 계정으로 등록되어 있는 상태였다... 🥲

<b>하지만</b>, 여기서 꼼수로 기존 이메일을 사용해서 샌드박스 계정을 생성할 수 있는 방법이 있다!! 바로 `[id]+[숫자]@[나머지]`와 같은 형태로 작성해도 기존 이메일 주소로 이메일 포워딩이 된다는 점을 이용하는 것이다.

예를 들어, 이메일 주소가 `shren0812@gmail.com`이라면 `shren0812+0812@gmail.com`으로 보내는 이메일 보내는 메일도 `shren0812@gmail.com`으로 이메일 포워딩이 되어 수신할 수 있다는 것이다.

![](https://i.imgur.com/COT71oP.png)

상기한 트릭을 사용하면 위 사진과 같이 샌드박스 계정을 생성할 수 있다.

이제 해당 샌드박스 계정을, 테스트할 때 사용할 아이폰에 등록해 주어야 한다.

![](https://i.imgur.com/W5f6wkT.jpeg)

`설정 > App Store > 샌드 박스 계정` 항목에, 방금 생성한 샌드 박스 계정을 등록한다.

## 🤔 다음은?

개발 외적으로 해주어야 하는 것은 모두 완료되었다.

글이 길어질 것 같아, 코드를 작성하는 부분은 다음 포스트에서 다루도록 하겠다...

